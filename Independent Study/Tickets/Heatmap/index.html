<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<title>Independent Study</title>

	<!-- Bootstrap CSS -->
	<link href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />

	<!-- Google Fonts stylesheet -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:700&display=swap" rel="stylesheet" />

	<!-- Other styles -->
	<link rel="stylesheet" type="text/css" href="styles.css">
	<script src="scripts.js"></script>

	<!-- D3.js -->
	<script src="https://d3js.org/d3.v4.js"></script>

</head>

<body>
	<!-- jumbotron -->
	<div class="jumbotron blue white-type">
		<div class="container">
			<h5>Independent Study</h5>
			<h1 class="display-4">HEADLINE</h1>
			<p class="lead">
				How expired meter tickets contribute to the city of Athens revenue.
			</p>
		</div>
	</div>

	<div class="container">
		<div class="row">
			<div class="col-6">
				<div id="my_dataviz"></div>
			</div>
		</div>
	</div>


	<!--  Footer -->
	<footer class="dark-footer">
		<div class="container">
			<div class="row">
				<div class="col">
					<p>Taylor Johnston Â© 2019</p>
				</div>
				<div class="col">
					<p class="float-right"><a href="#">Back to top</a></p>
				</div>
			</div>
		</div>
	</footer>

	<script>
		// set the dimensions and margins of the graph
		var margin = {
				top: 80,
				right: 52,
				bottom: 30,
				left: 40
			},
			width = 1400 - margin.left - margin.right,
			height = 500 - margin.top - margin.bottom;

		// append the svg object to the body of the page
		var svg = d3.select("#my_dataviz")
			.append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.append("g")
			.attr("transform",
				"translate(" + margin.left + "," + margin.top + ")");

		//Read the data
		d3.csv("https://raw.githubusercontent.com/johnstont05/independent-study_fall19/master/Independent%20Study/Tickets/Heatmap/data/tickets_clean.csv", function(data) {

			// Labels of row and columns -> unique identifier of the column called 'group' and 'variable'
			var myGroups = d3.map(data, function(d) {
				return d.week;
			}).keys()
			var myVars = d3.map(data, function(d) {
				return d.day;
			}).keys()

			// Build X scales and axis:
			var x = d3.scaleBand()
				.range([0, width])
				.domain(myGroups)
				.padding(0.05);
			svg.append("g")
				.style("font-size", 10)
				.attr("transform", "translate(0," + height + ")")
				.call(d3.axisBottom(x).tickSize(0))
				.select(".domain").remove()

			// Build Y scales and axis:
			var y = d3.scaleBand()
				.range([height, 0])
				.domain(myVars)
				.padding(0.05);
			svg.append("g")
				.style("font-size", 10)
				.call(d3.axisLeft(y).tickSize(0))
				.select(".domain").remove()

			// Build color scale
			var myColor = d3.scaleLinear()
				.range(["#C8EEE9", "#004615"])
				.domain([1, 600])

			// create a tooltip
			var tooltip = d3.select("#my_dataviz")
				.append("div")
				.style("opacity", 0)
				.attr("class", "tooltip")
				.style("background-color", "white")
				.style("border", "solid")
				.style("border-width", "2px")
				.style("border-radius", "5px")
				.style("padding", "5px")

			// Three function that change the tooltip when user hover / move / leave a cell
			var mouseover = function(d) {
				tooltip
					.style("opacity", 1)
				d3.select(this)
					.style("stroke", "black")
					.style("opacity", 1)
			}
			var mousemove = function(d) {
				tooltip
					.html("The exact value of<br>this cell is: " + d.value)
					.style("left", (d3.mouse(this)[0] + 70) + "px")
					.style("top", (d3.mouse(this)[1]) + "px")
			}
			var mouseleave = function(d) {
				tooltip
					.style("opacity", 0)
				d3.select(this)
					.style("stroke", "none")
					.style("opacity", 0.8)
			}

			// add the squares
			svg.selectAll()
				.data(data, function(d) {
					return d.week + ':' + d.day;
				})
				.enter()
				.append("rect")
				.attr("x", function(d) {
					return x(d.week)
				})
				.attr("y", function(d) {
					return y(d.day)
				})
				.attr("rx", 4)
				.attr("ry", 4)
				.attr("width", x.bandwidth())
				.attr("height", y.bandwidth())
				.style("fill", function(d) {
					return myColor(d.value)
				})
				.style("stroke-width", 4)
				.style("stroke", "none")
				.style("opacity", 0.8)
				.on("mouseover", mouseover)
				.on("mousemove", mousemove)
				.on("mouseleave", mouseleave)
		})

		// Add title to graph
		svg.append("text")
			.attr("x", 0)
			.attr("y", -50)
			.attr("text-anchor", "left")
			.style("font-size", "22px")
			.text("A d3.js heatmap");

		// Add subtitle to graph
		svg.append("text")
			.attr("x", 0)
			.attr("y", -20)
			.attr("text-anchor", "left")
			.style("font-size", "14px")
			.style("fill", "grey")
			.style("max-width", 400)
			.text("A short description of the take-away message of this chart.");
	</script>


	<!-- JavaScript dependencies: first jQuery, then Popper.js, then Bootstrap JS -->
	<script src="https://unpkg.com/jquery/dist/jquery.min.js"></script>
	<script src="https://unpkg.com/popper.js/dist/umd/popper.min.js"></script>
	<script src="https://unpkg.com/bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.6.7/d3-tip.min.js"></script>


</body>

</html>
